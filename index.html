<!DOCTYPE html>
<html lang="en" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apna Doctor - Professional</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <style>
        :root { --primary: #007bff; --success: #25D366; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); margin: 0; padding-bottom: 75px; transition: 0.3s; overflow-x: hidden; }
        .rtl { direction: rtl; text-align: right; }
        .ltr { direction: ltr; text-align: left; }
        .header { background: var(--primary); color: white; padding: 15px; text-align: center; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
        .lang-btn { background: white; color: var(--primary); border: none; padding: 5px 10px; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 12px; }
        .page { display: none; padding: 15px; animation: fadeIn 0.4s; }
        .active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .auth-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); width: 85%; max-width: 400px; margin: 50px auto; text-align: center; }
        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; border-inline-start: 5px solid var(--primary); }
        .btn-wa { background: var(--success); color: white; text-decoration: none; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: bold; position: absolute; inset-inline-end: 10px; top: 10px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: none; justify-content: space-around; padding: 12px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); border-top: 1px solid #eee; }
        .nav-item { border: none; background: none; color: #666; font-size: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .del-btn { color: red; background: none; border: none; font-size: 10px; cursor: pointer; margin-top: 5px; display: block; }
    </style>
</head>
<body class="ltr" id="mainBody">

    <div class="header">
        <button class="lang-btn" onclick="toggleLanguage()" id="langToggle">ÿßÿ±ÿØŸà</button>
        <span id="txt-appTitle">Apna Doctor</span>
        <div style="width: 40px;"></div>
    </div>

    <div id="rolePage" class="page active-page">
        <div class="auth-card">
            <h2 id="txt-welcome">Welcome</h2>
            <p id="txt-selectRole">Select your role</p>
            <button class="btn-main" onclick="showForm('doc')" id="txt-imDoctor">I am a Doctor</button>
            <button class="btn-main" style="background:#6c757d; margin-top:10px;" onclick="showForm('pub')" id="txt-imPatient">I am a Patient</button>
        </div>
    </div>

    <div id="docFormPage" class="page">
        <div class="auth-card">
            <h3 id="txt-docReg">Doctor Registration</h3>
            <input type="text" id="dName" placeholder="Full Name">
            <input type="text" id="dSpec" placeholder="Specialization">
            <input type="tel" id="dPhone" placeholder="WhatsApp Number">
            <button class="btn-main" onclick="register('doctors')">Create Account</button>
            <button onclick="location.reload()" style="border:none; background:none; color:gray; margin-top:10px;">Back</button>
        </div>
    </div>

    <div id="pubFormPage" class="page">
        <div class="auth-card">
            <h3 id="txt-patReg">Patient Registration</h3>
            <input type="text" id="pName" placeholder="Your Name">
            <input type="tel" id="pPhone" placeholder="WhatsApp Number">
            <button class="btn-main" onclick="register('patients')">Join Now</button>
            <button onclick="location.reload()" style="border:none; background:none; color:gray; margin-top:10px;">Back</button>
        </div>
    </div>

    <div id="homePage" class="page"><div id="listContainer"></div></div>
    <div id="dashPage" class="page">
        <div class="card" style="text-align:center; padding: 30px;">
            <h3 id="txt-liveStatus">Live Status</h3>
            <p style="color:green; font-weight:bold;">‚óè <span id="txt-online">Online</span></p>
            <hr><p id="txt-totalContacts">Total Contacts:</p> <b id="statCount">0</b>
        </div>
    </div>
    <div id="profilePage" class="page">
        <div class="card" style="text-align:center;">
            <div style="font-size:50px;">üë§</div>
            <h3 id="profName">-</h3>
            <p id="profSpec">-</p>
            <button class="btn-main" style="background:#dc3545;" onclick="logout()">Logout / Reset</button>
        </div>
    </div>

    <nav class="nav-bar" id="mainNav">
        <button class="nav-item active" onclick="switchTab('homePage', this)"><span id="txt-navHome">Home</span></button>
        <button class="nav-item" onclick="switchTab('dashPage', this)"><span id="txt-navDash">Dashboard</span></button>
        <button class="nav-item" onclick="switchTab('profilePage', this)"><span id="txt-navProf">Profile</span></button>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDVJq00WDiMIZTuhaZnGKLeqLoBhOAUgWc",
            authDomain: "apna-doctor-d928f.firebaseapp.com",
            databaseURL: "https://apna-doctor-d928f-default-rtdb.firebaseio.com",
            projectId: "apna-doctor-d928f",
            appId: "1:488555434869:web:2f707ea67409e52ecd793c"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentLang = 'en';
        let userRole = '';

        const translations = {
            en: { appTitle: "Apna Doctor", welcome: "Welcome", selectRole: "Select role", imDoctor: "Doctor", imPatient: "Patient", docReg: "Doctor Registration", patReg: "Patient Registration", navHome: "Home", navDash: "Dashboard", navProf: "Profile", logout: "Logout", liveStatus: "Live Status", online: "Online", totalContacts: "Contacts", namePh: "Full Name", specPh: "Specialization", numPh: "WhatsApp", loading: "Loading...", noData: "No data" },
            ur: { appTitle: "ÿßŸæŸÜÿß ⁄àÿß⁄©Ÿπÿ±", welcome: "ÿÆŸàÿ¥ ÿ¢ŸÖÿØ€åÿØ", selectRole: "ÿ±ŸàŸÑ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫", imDoctor: "⁄àÿß⁄©Ÿπÿ±", imPatient: "ŸÖÿ±€åÿ∂", docReg: "⁄àÿß⁄©Ÿπÿ± ÿ±ÿ¨ÿ≥Ÿπÿ±€åÿ¥ŸÜ", patReg: "ŸÖÿ±€åÿ∂ ÿ±ÿ¨ÿ≥Ÿπÿ±€åÿ¥ŸÜ", navHome: "€ÅŸàŸÖ", navDash: "⁄à€åÿ¥ ÿ®Ÿàÿ±⁄à", navProf: "Ÿæÿ±ŸàŸÅÿßÿ¶ŸÑ", logout: "ŸÑÿß⁄Ø ÿ¢ÿ§Ÿπ", liveStatus: "ŸÑÿßÿ¶€åŸà ÿßÿ≥Ÿπ€åŸπÿ≥", online: "ÿ¢ŸÜ ŸÑÿßÿ¶ŸÜ", totalContacts: "ÿ±ÿßÿ®ÿ∑€í", namePh: "ŸÜÿßŸÖ", specPh: "ŸÖ€Åÿßÿ±ÿ™", numPh: "ŸÜŸÖÿ®ÿ±", loading: "ŸÑŸà⁄à €ÅŸà ÿ±€Åÿß €Å€í...", noData: "⁄à€åŸπÿß ŸÜ€Å€å⁄∫ €Å€í" }
        };

        // AUTO-LOGIN CHECK
        window.onload = function() {
            let saved = localStorage.getItem('doctorAppUser');
            if(saved) {
                let u = JSON.parse(saved);
                userRole = u.role;
                loginSuccess(u.name, u.spec);
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ur' : 'en';
            document.getElementById('mainBody').className = currentLang === 'ur' ? 'rtl' : 'ltr';
            document.getElementById('langToggle').innerText = currentLang === 'ur' ? 'English' : 'ÿßÿ±ÿØŸà';
            updateUI();
        }

        function updateUI() {
            const t = translations[currentLang];
            document.getElementById('txt-appTitle').innerText = t.appTitle;
            document.getElementById('txt-welcome').innerText = t.welcome;
            document.getElementById('txt-navHome').innerText = t.navHome;
            document.getElementById('txt-navDash').innerText = t.navDash;
            document.getElementById('txt-navProf').innerText = t.navProf;
            // Placeholders
            document.getElementById('dName').placeholder = t.namePh;
            document.getElementById('pName').placeholder = t.namePh;
            document.getElementById('dPhone').placeholder = t.numPh;
            document.getElementById('pPhone').placeholder = t.numPh;
        }

        function showForm(role) {
            document.getElementById('rolePage').classList.remove('active-page');
            document.getElementById(role === 'doc' ? 'docFormPage' : 'pubFormPage').classList.add('active-page');
        }

        function register(type) {
            let name = type === 'doctors' ? document.getElementById('dName').value : document.getElementById('pName').value;
            let phone = type === 'doctors' ? document.getElementById('dPhone').value : document.getElementById('pPhone').value;
            let spec = type === 'doctors' ? document.getElementById('dSpec').value : 'Patient';

            if(!name || !phone) return alert("Fill data!");
            
            let uData = {name, phone, spec, role: type};
            db.ref(type).push(uData).then(() => {
                localStorage.setItem('doctorAppUser', JSON.stringify(uData));
                userRole = type;
                loginSuccess(name, spec);
            });
        }

        function loginSuccess(name, spec) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById('homePage').classList.add('active-page');
            document.getElementById('mainNav').style.display = 'flex';
            document.getElementById('profName').innerText = name;
            document.getElementById('profSpec').innerText = spec;
            loadData();
        }

        function logout() {
            localStorage.removeItem('doctorAppUser');
            location.reload();
        }

        function loadData() {
            let path = userRole === 'doctors' ? 'patients' : 'doctors';
            db.ref(path).on('value', snap => {
                let html = ''; let count = 0;
                snap.forEach(c => {
                    let d = c.val(); let key = c.key;
                    html += `<div class="card">
                        <b>${d.name}</b><br><small>${d.spec}</small>
                        <a href="https://wa.me/${d.phone}" class="btn-wa">WhatsApp</a>
                        <button class="del-btn" onclick="delItem('${path}','${key}')">Delete Account</button>
                    </div>`;
                    count++;
                });
                document.getElementById('listContainer').innerHTML = html || 'No users online';
                document.getElementById('statCount').innerText = count;
            });
        }

        function delItem(path, key) {
            if(confirm("Are you sure?")) db.ref(path + '/' + key).remove();
        }

        function switchTab(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(pageId).classList.add('active-page');
            el.classList.add('active');
        }
    </script>
</body>
</html>
