<!DOCTYPE html>
<html lang="en" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apna Doctor - Official App</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <style>
        :root { --primary: #007bff; --success: #25D366; --danger: #dc3545; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--light); margin: 0; padding-bottom: 80px; transition: 0.3s; overflow-x: hidden; }
        .rtl { direction: rtl; text-align: right; }
        .ltr { direction: ltr; text-align: left; }

        /* Header */
        .header { background: var(--primary); color: white; padding: 15px; text-align: center; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .lang-btn { background: white; color: var(--primary); border: none; padding: 6px 12px; border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 11px; }

        /* Pages */
        .page { display: none; padding: 15px; animation: fadeIn 0.4s ease; }
        .active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards & UI */
        .auth-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 85%; max-width: 400px; margin: 40px auto; text-align: center; }
        .card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); position: relative; border-inline-start: 6px solid var(--primary); }
        .btn-wa { background: var(--success); color: white; text-decoration: none; padding: 8px 15px; border-radius: 10px; font-size: 12px; font-weight: bold; position: absolute; inset-inline-end: 15px; top: 20px; display: flex; align-items: center; gap: 5px; }
        
        input { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; outline: none; }
        input:focus { border-color: var(--primary); }
        .btn-main { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .btn-main:active { transform: scale(0.98); }

        /* Bottom Nav */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: none; justify-content: space-around; padding: 12px 0; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); border-top: 1px solid #eee; }
        .nav-item { border: none; background: none; color: #888; font-size: 11px; cursor: pointer; display: flex; flex-direction: column; align-items: center; flex: 1; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
    </style>
</head>
<body class="ltr" id="mainBody">

    <div class="header">
        <button class="lang-btn" onclick="toggleLanguage()" id="langToggle">ÿßÿ±ÿØŸà</button>
        <span id="txt-appTitle" style="font-weight: bold; font-size: 18px;">Apna Doctor</span>
        <div style="width: 50px;"></div>
    </div>

    <div id="rolePage" class="page active-page">
        <div class="auth-card">
            <h2 id="txt-welcome">Welcome</h2>
            <p id="txt-selectRole" style="color:#666;">Choose how you want to use the app</p>
            <button class="btn-main" onclick="showForm('doc')" id="txt-imDoctor">I am a Doctor</button>
            <button class="btn-main" style="background:#6c757d; margin-top:12px;" onclick="showForm('pub')" id="txt-imPatient">I am a Patient</button>
        </div>
    </div>

    <div id="docFormPage" class="page">
        <div class="auth-card">
            <h3 id="txt-docReg">Doctor Registration</h3>
            <input type="text" id="dName" placeholder="Dr. Full Name">
            <input type="text" id="dSpec" placeholder="Specialization (e.g. Heart Expert)">
            <input type="tel" id="dPhone" placeholder="WhatsApp (923...)">
            <button class="btn-main" onclick="register('doctors')" id="txt-createAcc">Create Account</button>
        </div>
    </div>

    <div id="pubFormPage" class="page">
        <div class="auth-card">
            <h3 id="txt-patReg">Patient Registration</h3>
            <input type="text" id="pName" placeholder="Your Name">
            <input type="tel" id="pPhone" placeholder="WhatsApp (923...)">
            <button class="btn-main" onclick="register('patients')" id="txt-joinNow">Join Now</button>
        </div>
    </div>

    <div id="homePage" class="page">
        <div id="listContainer"></div>
    </div>
    
    <div id="dashPage" class="page">
        <div class="card" style="text-align:center; padding: 40px 20px;">
            <div style="width: 15px; height: 15px; background: var(--success); border-radius: 50%; margin: 0 auto 10px; box-shadow: 0 0 10px var(--success);"></div>
            <h3 id="txt-liveStatus">Live Status</h3>
            <p style="color:var(--success); font-weight:bold;" id="txt-online">You are Online</p>
            <hr style="opacity: 0.1; margin: 20px 0;">
            <p id="txt-totalContacts">Total Active Connections</p> 
            <b style="font-size: 30px; color: var(--primary);" id="statCount">0</b>
        </div>
    </div>

    <div id="profilePage" class="page">
        <div class="card" style="text-align:center; padding: 25px;">
            <div style="font-size:60px; margin-bottom: 10px;">üë§</div>
            <h3 id="profName" style="margin: 0;">-</h3>
            <p id="profSpec" style="color: #666; margin: 5px 0;">-</p>
            <button onclick="logout()" style="border:none; background:none; color:gray; text-decoration: underline; cursor:pointer;">Logout</button>
        </div>

        <div style="margin-top: 25px;">
            <h4 id="txt-supportTitle" style="border-inline-start: 4px solid var(--primary); padding-inline-start: 10px;">Help & Support</h4>
            <div class="card" style="border-inline-start-color: var(--success);">
                <b id="txt-devName">Developer: Sudais Khan</b>
                <p style="font-size: 13px; color: #555;" id="txt-devDesc">Created to help people connect with doctors easily.</p>
                <a href="https://wa.me/923000000000?text=Salam Admin, I need help with Apna Doctor App" class="btn-main" style="background:var(--success); text-decoration:none; display:block; text-align:center; font-size:14px;">Contact Admin</a>
            </div>
            
            <button class="btn-main" style="background:var(--danger); margin-top: 20px; font-size: 14px;" onclick="deleteMyOwnAccount()" id="txt-delAcc">Delete My Account Permanently</button>
        </div>
    </div>

    <nav class="nav-bar" id="mainNav">
        <button class="nav-item active" onclick="switchTab('homePage', this)"><i>üè†</i><span id="txt-navHome">Home</span></button>
        <button class="nav-item" onclick="switchTab('dashPage', this)"><i>üìä</i><span id="txt-navDash">Dashboard</span></button>
        <button class="nav-item" onclick="switchTab('profilePage', this)"><i>üë§</i><span id="txt-navProf">Profile</span></button>
    </nav>

    <script>
        // Firebase Setup
        const firebaseConfig = {
            apiKey: "AIzaSyDVJq00WDiMIZTuhaZnGKLeqLoBhOAUgWc",
            authDomain: "apna-doctor-d928f.firebaseapp.com",
            databaseURL: "https://apna-doctor-d928f-default-rtdb.firebaseio.com",
            projectId: "apna-doctor-d928f",
            appId: "1:488555434869:web:2f707ea67409e52ecd793c"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentLang = 'en';
        let userRole = '';
        let myKey = '';

        const translations = {
            en: {
                appTitle: "Apna Doctor", welcome: "Welcome", selectRole: "Select role", imDoctor: "I am a Doctor", imPatient: "I am a Patient",
                docReg: "Doctor Registration", patReg: "Patient Registration", createAcc: "Create Account", joinNow: "Join Now",
                navHome: "Home", navDash: "Dashboard", navProf: "Profile", logout: "Logout", liveStatus: "Live Status", online: "You are Online",
                totalContacts: "Total Active Connections", supportTitle: "Help & Support", devName: "Developer: Sudais Khan",
                devDesc: "Created to help people connect with doctors easily.", delAcc: "Delete My Account Permanently",
                loading: "Loading...", noData: "No users online right now"
            },
            ur: {
                appTitle: "ÿßŸæŸÜÿß ⁄àÿß⁄©Ÿπÿ±", welcome: "ÿÆŸàÿ¥ ÿ¢ŸÖÿØ€åÿØ", selectRole: "ÿ±ŸàŸÑ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫", imDoctor: "ŸÖ€å⁄∫ ⁄àÿß⁄©Ÿπÿ± €ÅŸà⁄∫", imPatient: "ŸÖ€å⁄∫ ŸÖÿ±€åÿ∂ €ÅŸà⁄∫",
                docReg: "⁄àÿß⁄©Ÿπÿ± ÿ±ÿ¨ÿ≥Ÿπÿ±€åÿ¥ŸÜ", patReg: "ŸÖÿ±€åÿ∂ ÿ±ÿ¨ÿ≥Ÿπÿ±€åÿ¥ŸÜ", createAcc: "ÿß⁄©ÿßÿ§ŸÜŸπ ÿ®ŸÜÿßÿ¶€å⁄∫", joinNow: "ÿßÿ®⁄æ€å ÿ¥ÿßŸÖŸÑ €ÅŸà⁄∫",
                navHome: "€ÅŸàŸÖ", navDash: "⁄à€åÿ¥ ÿ®Ÿàÿ±⁄à", navProf: "Ÿæÿ±ŸàŸÅÿßÿ¶ŸÑ", logout: "ŸÑÿß⁄Ø ÿ¢ÿ§Ÿπ", liveStatus: "ŸÑÿßÿ¶€åŸà ÿßÿ≥Ÿπ€åŸπÿ≥", online: "ÿ¢Ÿæ ÿ¢ŸÜ ŸÑÿßÿ¶ŸÜ €Å€å⁄∫",
                totalContacts: "⁄©ŸÑ ÿß€å⁄©Ÿπ€åŸà ÿ±ÿßÿ®ÿ∑€í", supportTitle: "ŸÖÿØÿØ ÿßŸàÿ± ÿ±ÿßÿ®ÿ∑€Å", devName: "⁄àŸà€åŸÑŸæÿ±: ÿ≥ÿØ€åÿ≥ ÿÆÿßŸÜ",
                devDesc: "€å€Å ÿß€åŸæ ŸÑŸà⁄ØŸà⁄∫ ÿßŸàÿ± ⁄àÿß⁄©Ÿπÿ±Ÿà⁄∫ ⁄©€í ÿ±ÿßÿ®ÿ∑€í ⁄©€í ŸÑ€å€í ÿ®ŸÜÿßÿ¶€å ⁄Øÿ¶€å €Å€í€î", delAcc: "ÿßŸæŸÜÿß ÿß⁄©ÿßÿ§ŸÜŸπ €ÅŸÖ€åÿ¥€Å ⁄©€í ŸÑ€å€í ÿÆÿ™ŸÖ ⁄©ÿ±€å⁄∫",
                loading: "ŸÑŸà⁄à €ÅŸà ÿ±€Åÿß €Å€í...", noData: "ÿßÿ≥ ŸàŸÇÿ™ ⁄©Ÿàÿ¶€å ÿ¢ŸÜ ŸÑÿßÿ¶ŸÜ ŸÜ€Å€å⁄∫ €Å€í"
            }
        };

        window.onload = function() {
            let saved = localStorage.getItem('doctorAppUser');
            if(saved) {
                let u = JSON.parse(saved);
                userRole = u.role;
                myKey = u.key;
                loginSuccess(u.name, u.spec);
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ur' : 'en';
            document.getElementById('mainBody').className = currentLang === 'ur' ? 'rtl' : 'ltr';
            document.getElementById('langToggle').innerText = currentLang === 'ur' ? 'English' : 'ÿßÿ±ÿØŸà';
            updateUI();
        }

        function updateUI() {
            const t = translations[currentLang];
            document.getElementById('txt-appTitle').innerText = t.appTitle;
            document.getElementById('txt-welcome').innerText = t.welcome;
            document.getElementById('txt-imDoctor').innerText = t.imDoctor;
            document.getElementById('txt-imPatient').innerText = t.imPatient;
            document.getElementById('txt-navHome').innerText = t.navHome;
            document.getElementById('txt-navDash').innerText = t.navDash;
            document.getElementById('txt-navProf').innerText = t.navProf;
            document.getElementById('txt-liveStatus').innerText = t.liveStatus;
            document.getElementById('txt-online').innerText = t.online;
            document.getElementById('txt-totalContacts').innerText = t.totalContacts;
            document.getElementById('txt-supportTitle').innerText = t.supportTitle;
            document.getElementById('txt-delAcc').innerText = t.delAcc;
        }

        function showForm(role) {
            document.getElementById('rolePage').classList.remove('active-page');
            document.getElementById(role === 'doc' ? 'docFormPage' : 'pubFormPage').classList.add('active-page');
        }

        function register(type) {
            let name = type === 'doctors' ? document.getElementById('dName').value : document.getElementById('pName').value;
            let phone = type === 'doctors' ? document.getElementById('dPhone').value : document.getElementById('pPhone').value;
            let spec = type === 'doctors' ? document.getElementById('dSpec').value : 'Patient';

            if(!name || !phone) return alert("Fill all fields!");

            let ref = db.ref(type).push();
            let uData = {name, phone, spec, role: type, key: ref.key};
            
            ref.set(uData).then(() => {
                localStorage.setItem('doctorAppUser', JSON.stringify(uData));
                myKey = ref.key;
                userRole = type;
                loginSuccess(name, spec);
            });
        }

        function loginSuccess(name, spec) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById('homePage').classList.add('active-page');
            document.getElementById('mainNav').style.display = 'flex';
            document.getElementById('profName').innerText = name;
            document.getElementById('profSpec').innerText = spec;
            loadData();
            updateUI();
        }

        function loadData() {
            let path = userRole === 'doctors' ? 'patients' : 'doctors';
            db.ref(path).on('value', snap => {
                let html = ''; let count = 0;
                snap.forEach(c => {
                    let d = c.val();
                    html += `<div class="card">
                        <b>${d.name}</b><br><small>${d.spec}</small>
                        <a href="https://wa.me/${d.phone.replace('+','')}" class="btn-wa">WhatsApp</a>
                    </div>`;
                    count++;
                });
                document.getElementById('listContainer').innerHTML = html || `<p style="text-align:center; color:gray; margin-top:50px;">${translations[currentLang].noData}</p>`;
                document.getElementById('statCount').innerText = count;
            });
        }

        function switchTab(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(pageId).classList.add('active-page');
            el.classList.add('active');
        }

        function deleteMyOwnAccount() {
            if(confirm("Are you sure you want to delete your account?")) {
                db.ref(userRole + '/' + myKey).remove().then(() => {
                    localStorage.removeItem('doctorAppUser');
                    location.reload();
                });
            }
        }

        function logout() {
            if(confirm("Logout?")) {
                localStorage.removeItem('doctorAppUser');
                location.reload();
            }
        }
    </script>
</body>
</html>
